{% extends 'layout.html' %}

{% block head %}
<title>{{ translations.favorites.myFavorites }} - {{ userName }}</title>
{% endblock head %}

{% block body %}
<div class="w-11/12 md:w-5/6 lg:w-7/12 xl:w-5/12 mx-auto mt-6 md:mt-10">
    <h1 class="text-2xl md:text-3xl font-bold text-rose-500 mb-6">
        <i class="ti ti-heart mr-2"></i>{{ translations.favorites.myFavorites }}
    </h1>
    
    {% if favorites %}
        <div class="space-y-4">
            {% for favorite in favorites %}
                <div class="card bg-base-100 shadow-md hover:shadow-lg transition-shadow duration-200">
                    <div class="card-body">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h2 class="card-title text-lg">
                                    <a href="/post/{{ getPostUrlID(favorite[0]) }}" class="hover:text-rose-500 duration-150">
                                        {{ favorite[1] }}
                                    </a>
                                </h2>
                                <p class="text-sm text-base-content/70 mt-2">
                                    {{ favorite[2] }}
                                </p>
                                <div class="flex items-center gap-4 mt-3 text-sm text-base-content/60">
                                    <span class="flex items-center">
                                        <i class="ti ti-user mr-1"></i>
                                        <a href="/user/{{ favorite[3] | lower }}" class="hover:text-rose-500 duration-150">
                                            {{ favorite[3] }}
                                        </a>
                                    </span>
                                    <span class="flex items-center">
                                        <i class="ti ti-calendar mr-1"></i>
                                        <span class="date">{{ favorite[4] }}</span>
                                    </span>
                                    <span class="flex items-center">
                                        <i class="ti ti-heart mr-1 text-rose-500"></i>
                                        <span class="date">{{ favorite[5] }}</span>
                                    </span>
                                </div>
                            </div>
                            <button 
                                onclick="toggleFavorite({{ favorite[0] }}, this)" 
                                class="btn btn-ghost btn-sm btn-circle text-rose-500 hover:text-rose-600"
                                title="{{ translations.favorites.removeFromFavorites }}"
                            >
                                <i class="ti ti-heart-filled text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <i class="ti ti-heart-off text-6xl text-base-content/30 mb-4"></i>
            <h3 class="text-lg font-medium text-base-content/60 mb-2">
                {{ translations.favorites.noFavorites }}
            </h3>
            <p class="text-sm text-base-content/50">
                {{ translations.favorites.startExploring }}
            </p>
        </div>
    {% endif %}
</div>

<script>
function toggleFavorite(postId, button) {
    fetch(`/article/${postId}/favorite`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token() }}'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Remove the card from DOM if unfavorited
            if (!data.favorited) {
                const card = button.closest('.card');
                card.style.transition = 'opacity 0.3s, transform 0.3s';
                card.style.opacity = '0';
                card.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    card.remove();
                    // Check if no favorites left
                    if (document.querySelectorAll('.card').length === 0) {
                        location.reload();
                    }
                }, 300);
            }
        } else {
            console.error('Error toggling favorite:', data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
</script>
{% endblock body %}